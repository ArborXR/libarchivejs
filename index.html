<html>
    <head>
        <title>libarchive.js Demo</title>
        <style>
            .files{
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                padding-top: 32px;
                line-height: 25px;
            }
        </style>
    </head>
    <body>
        Choose file <input type="file" id="file" />
        <div class="files" id="files" >

        </div>
        <script type="module">
            import {Archive} from '/node_modules/libarchive.js/main.js';

            Archive.init({
                workerUrl: '/node_modules/libarchive.js/dist/worker-bundle.js'
            });

            document.getElementById('file').addEventListener('change', async (e) => {
                const file = e.currentTarget.files[0];
                const archive = await Archive.open(file);
                let obj = await archive.extractFiles( fileExtracted );
            });

            function fileExtracted(entry){
                const a = document.createElement('a');
                a.innerHTML = entry.path;
                a.setAttribute('download',entry.file.name);
                document.querySelector('#files').appendChild(a);
                
                const reader = new FileReader();
                reader.onload = ({target}) => {
                    a.href = target.result;
                };
                reader.readAsDataURL(entry.file);
            }
        </script>
    </body>
</html>